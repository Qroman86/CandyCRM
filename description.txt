Candycrm - это БД  для небольшой кондитерской, хранящая и обрабатывающая информацию о заказах и заказчиках, рецептах,
закупках ингридиентов и упаковок, а также о том, что сейчас по факту хранится в кладовой. Предполагается, что заказы 
оформляются онлайн, позиции заказа (собственно кондитерские изделия - конфеты и торты) готовятся в цеху и по мере готовности забираются клиентами.
При приготовлении кондитерских изделий используются два типа товаров - весовые ингридиенты и поштучные упаковки.
Ингридиенты хранятся и закупаются в таре определенной емкости по весу. Например мука может закупаться в пачках по 500 
или 1000 грамм. Упаковка используется для конечного оформления приготовленных кондитерских изделий.


Представлены следующие таблицы:
1) customers - информация о клиентах кондитерской (ФИО, мобильный номер и email);
2) orders - информация о заказах, включающая срок, к которому следует изготовить заказ (столбец deadline) 
и текущий статус заказа (столбец status, принимающий три значения 'CREATE', 'INPROGRESS' и 'DONE');
3) order_reviews - таблица отзывов по заказам, включающая текст отзыва (столбец review_text) и оценку заказа (столбец rating)
4) recipes - таблица рецептов, включающая инструкцию по приготовлению и общее время приготовления 
в минутах (столбец cook_time_minutes);
5) range_items - ассортимент кондитерских изделий, с указанием ссылки на рецепт и цену; 
6) commodities - таблица товаров, использующихся при изготовлении заказа. Товар может быть ингридиентом или упаковкой 
(на это указывает значение столбца is_ingredient), а также весовым или штучным (за этот признак отвечает 
столбец is_weight);
7) order_range_items - таблица позиций заказа из ассортимента кондитерской, т.е. не являющихся упаковкой;
8) order_non_range_items - таблица позиций заказа, являющихся упаковкой (например конверт для булочки с маком);
9) recipe_items - позиция рецепта, хранящая информацию о том какой ингридиент и в каком количестве (в граммах)
следует использовать при приготовлении по рецепту;
10) purchases - список закупок, в зависимости от того оплачен или нет находится в статусе 'CREATE' или 'DONE';
11) purchase_items - позиции списка закупок;
12) larder_items - таблица содержит информацию о том, что хранится в кладовой. Специфическим параметром является
weight_residue - остаток хранения в процентах. Например если осталось четверть пачки, то в поле quantity будет записано 
число 1, а в поле weight_residue число 25;
13) cooking_slots - слоты готовки для каждой позиции заказа. Например если позиция заказа - это два торта "Наполеон",
то создается одна запись слота готовка с удвоенным временем приготовления для соответствующего времени приготовления
по рецепту. Столбец confectioner_id - это опциональный столбец для хранения информации об идентификаторе сотрудника
кондитерской.

 


Функция check_is_ingredients_enough_for_order(order_id BIGINT) проверяет достаточно ли в кладовой ингридиентов для
изготовления заказа по указанному идентификатору заказа, возвращает в зависимости от результата 0 или 1.
Процедура generate_purchase(IN order_id_in BIGINT) - формирует при недостатке продуктов и упаковки в кладовой список закупки, таким 
образом, чтобы минимальным количеством покрыть потребности заказа. Список позиций закупок формируется со статусом 
'CREATE' - это означает, что сформирован список что нужно купить и в каком количестве, но еще не определено где
будет выполнена закупка и по каким ценам.

Порядок запуска скриптов
create_database.sql
create_views.sql
create_procedures_and_triggers.sql
fill_database.sql
selects.sql

 